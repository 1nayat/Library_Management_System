@{
    ViewData["Title"] = "Issue Book";
}

<h2>Issue Book</h2>

<form asp-action="IssueBook" method="post">
    <div class="form-group mb-2">
        <label>Student</label>
        <input list="studentList" id="studentInput" class="form-control" placeholder="Search Student..." required />
        <input type="hidden" name="studentId" id="studentId" />
        <datalist id="studentList">
            @foreach (var student in ViewBag.Students)
            {
                <option data-id="@student.Id" value="@student.Name (@student.Email)"></option>
            }
        </datalist>
    </div>

    <div class="form-group mb-2">
        <label>Book</label>
        <input list="bookList" id="bookInput" class="form-control" placeholder="Search Book..." required />
        <input type="hidden" name="bookId" id="bookId" />
        <datalist id="bookList">
            @foreach (var book in ViewBag.Books)
            {
                <option data-id="@book.BookID" value="@book.BookName (Available: @book.AvailableQnt)"></option>
            }
        </datalist>
    </div>

    <div class="form-group mb-2">
        <label>Days to Rent</label>
        <input type="number" name="days" class="form-control" required min="1" />
    </div>

    <button type="submit" class="btn btn-primary">Issue Book</button>
    <a class="btn btn-secondary" href="/Admin/IssuedBooks">Cancel</a>
</form>

<script>
    function setupDatalist(inputId, hiddenId, datalistId) {
        const input = document.getElementById(inputId);
        const hidden = document.getElementById(hiddenId);
        const options = document.querySelectorAll(`#${datalistId} option`);

        input.addEventListener('input', function () {
            hidden.value = ''; 
            options.forEach(option => {
                if (option.value === input.value) {
                    hidden.value = option.dataset.id; 
                }
            });
        });
    }

    setupDatalist('studentInput', 'studentId', 'studentList');
    setupDatalist('bookInput', 'bookId', 'bookList');
</script>
